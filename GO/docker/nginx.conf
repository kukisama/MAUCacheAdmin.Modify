server {
    listen 80;
    server_name _;

    # 文件根目录（和 sync 容器共享同一个 volume）
    root /data/maucache;

    # 目录浏览（替代 IIS 目录浏览功能）
    autoindex on;

    # 补充 MIME 类型（替代 PrepIISServer.ps1 手动配置 MIME）
    types {
        application/octet-stream      pkg mpkg;
        application/vnd.ms-pki.seccat cat;
    }

    # 大文件传输优化（.pkg 文件可达数百 MB~1GB）
    sendfile    on;
    tcp_nopush  on;

    # JSON 格式访问日志（替代 IIS W3C 日志，便于 jq/Loki 查询）
    log_format json escape=json
        '{'
            '"time":"$time_iso8601",'
            '"client":"$remote_addr",'
            '"method":"$request_method",'
            '"path":"$request_uri",'
            '"status":$status,'
            '"size":$body_bytes_sent,'
            '"duration":$request_time,'
            '"ua":"$http_user_agent"'
        '}';

    access_log /data/logs/access.log json;

    # 禁止客户端访问临时下载目录
    location /.tmp/ {
        deny all;
    }
}
